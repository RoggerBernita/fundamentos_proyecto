-- Crear esquema personalizado
CREATE SCHEMA IF NOT EXISTS rbernita;

-- 1. Tabla Maestra: Clientes
CREATE TABLE rbernita.m_clientes (
    id_cliente SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    telefono VARCHAR(20),
    direccion TEXT,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. Tabla Maestra: Habitaciones
CREATE TABLE rbernita.m_habitaciones (
    id_habitacion SERIAL PRIMARY KEY,
    numero VARCHAR(10) UNIQUE NOT NULL,
    tipo VARCHAR(50) NOT NULL, -- Individual, Doble, Suite, etc.
    precio_noche DECIMAL(10, 2) NOT NULL,
    estado VARCHAR(20) DEFAULT 'Disponible' -- Disponible, Ocupada, Mantenimiento
);

-- 3. Tabla Maestra: Servicios
CREATE TABLE rbernita.m_servicios (
    id_servicio SERIAL PRIMARY KEY,
    nombre_servicio VARCHAR(100) NOT NULL,
    precio DECIMAL(10, 2) NOT NULL
);

-- 4. Tabla Transaccional: Reservas
CREATE TABLE rbernita.t_reservas (
    id_reserva SERIAL PRIMARY KEY,
    id_cliente INT NOT NULL,
    id_habitacion INT NOT NULL,
    fecha_entrada DATE NOT NULL,
    fecha_salida DATE NOT NULL,
    total_reserva DECIMAL(10, 2) DEFAULT 0.00,
    estado_reserva VARCHAR(20) DEFAULT 'Confirmada', -- Confirmada, Cancelada, Finalizada
    CONSTRAINT fk_cliente FOREIGN KEY (id_cliente) REFERENCES rbernita.m_clientes(id_cliente),
    CONSTRAINT fk_habitacion FOREIGN KEY (id_habitacion) REFERENCES rbernita.m_habitaciones(id_habitacion)
);

-- 5. Tabla Transaccional: Detalle de Servicios
CREATE TABLE rbernita.t_detalle_servicios (
    id_detalle SERIAL PRIMARY KEY,
    id_reserva INT NOT NULL,
    id_servicio INT NOT NULL,
    fecha_servicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    cantidad INT DEFAULT 1,
    subtotal DECIMAL(10, 2) NOT NULL,
    CONSTRAINT fk_reserva_servicio FOREIGN KEY (id_reserva) REFERENCES rbernita.t_reservas(id_reserva),
    CONSTRAINT fk_servicio FOREIGN KEY (id_servicio) REFERENCES rbernita.m_servicios(id_servicio)
);

-- 6. Tabla Transaccional: Pagos
CREATE TABLE rbernita.t_pagos (
    id_pago SERIAL PRIMARY KEY,
    id_reserva INT NOT NULL,
    fecha_pago TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metodo_pago VARCHAR(50) NOT NULL, -- Efectivo, Tarjeta, Transferencia
    monto_pagado DECIMAL(10, 2) NOT NULL,
    CONSTRAINT fk_reserva_pago FOREIGN KEY (id_reserva) REFERENCES rbernita.t_reservas(id_reserva)
);
  
